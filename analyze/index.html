<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>班级学情</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/main.css">
    <script src="./js/echarts.min.js"></script>
</head>

<body>
    <div class="container">
        <span class="subtitle">课堂表现</span>
        <a href="javascript:;" class="btn btn-default btn-sm btn-detail class-detail">详情</a>
        <div id="result" style="width: 100%;height:400px;margin-bottom: 20px"></div>

        <span class="subtitle">测验成绩</span>
        <a href="#" class="btn btn-default btn-sm btn-detail exam-detail">详情</a>
        <div id="exam" style="width: 100%;height:400px;"></div>
    </div>

    <script src="./js/jquery-3.2.1.min.js"></script>
    <script src="./js/common.js"></script>
    <script type="text/javascript">
        var urlPre = "http://w21.pdoca.com/WEBservice/HuDongKeTang/teacherinfo.asmx/";
        var classId = getParam('banJiID');
        var tpId = getParam('tpID');
        var subjectId = getParam('subjectID');
        var defaultParam = {
            banJiID: classId,
            tpID: tpId,
            subjectID: subjectId,
            startTime: '',
            endTime: ''
        }
        var resChart = echarts.init(document.getElementById('result'));

        var option1 = {
            xAxis: {
                data: ["认真（平均）", "积极（平均）", "效率（平均）"],
                axisLine: {
                    lineStyle: {
                        color: '#cccccc'
                    }
                },
                axisLabel: {
                    textStyle: {
                        color: '#666666',
                        fontWeight: '400'
                    }
                }
            },
            yAxis: {
                name: '单位/%',
                max: 100,
                nameTextStyle: {
                    color: '#999999',
                    fontSize: 12,
                    // fontFamily: 'NotoSansHans-Light'
                },
                axisLine: {
                    lineStyle: {
                        color: '#cccccc'
                    }
                },
                axisLabel: {
                    textStyle: {
                        color: '#666666',
                        fontWeight: '400'
                    }
                }
            },

            series: [{
                type: 'bar',
                data: [],
                itemStyle: {
                    normal: {
                        color: function(params) {
                            // build a color map as your need.
                            var colorList = [
                                '#00bda5', '#ff4526', '#ffc600'
                            ];
                            return colorList[params.dataIndex]
                        },
                        opacity: 0.5,
                        label: {
                            show: true,
                            textStyle: {
                                color: '#999999',
                                fontSize: '10px'
                            },
                            position: 'top'
                        }
                    }
                },
                barWidth: '50%',
                //     barGap:'-100%',
                // barCategoryGap:'40%',
                // barGap: '30%',
            }]
        };
        resChart.setOption(option1);

        $.ajax({
            url: urlPre + 'getBanJiAvgLearningAnalysis_KeTangBiaoXian',
            data: defaultParam,
            type: 'POST',
            success: function(data) {
                var data = JSON.parse($(data).text()),
                    list = [data.RenZhenAvg, data.JiJiAvg, data.XiaoLvAvg];
                var resList = list.map(function(obj) {
                    return formateNum(obj);
                });
                resChart.setOption({
                    series: [{
                        data: resList
                    }]
                })
            },
            error: function(e) {
                alert('出错啦');
            }
        })

        var examChart = echarts.init(document.getElementById('exam'));
        var option2 = {

            radar: [{
                name: {
                    textStyle: {
                        color: '#666666'
                    }
                },
                indicator: [{
                        text: '课前预习',
                        max: 100
                    },
                    {
                        text: '截屏测验',
                        max: 100
                    },
                    {
                        text: '课后作业',
                        max: 100
                    },
                    {
                        text: '随堂测验',
                        max: 100
                    }
                ],
                axisLabel: {
                    show: true,
                    showMinLabel: false,
                    textStyle: {
                        color: '#cccccc',
                        fontSize: '12px'
                    }
                },
                center: ['50%', '30%'],
                radius: 95
            }, ],
            series: [{
                type: 'radar',
                tooltip: {
                    trigger: 'item'
                },
                itemStyle: {
                    normal: {
                        borderColor: '#00bda5',
                        areaStyle: {
                            type: 'default',
                            color: '#00bda5',
                            opacity: 0.3
                        },
                        lineStyle: {
                            color: '#00bda5'
                        }
                    },
                },
                data: [{
                    value: [],
                }]
            }],
            textStyle: {
                color: '#000'
            }

        };

        examChart.setOption(option2);

        $.ajax({
            url: urlPre + 'getBanJiAvgLearningAnalysis_CeYan',
            data: defaultParam,
            type: 'GET',
            success: function(data) {
                var data = JSON.parse($(data).text());
                var list = [data.KeQianRightPercentAvg, data.KeZhongRightPercentAvg, data.KeHouRightPercentAvg, data.JiePingRightPercentAvg];
                var resList = list.map(function(obj) {
                    return formateNum(obj);
                });
                examChart.setOption({
                    series: [{
                        data: [{
                            value: resList
                        }]
                    }]
                })
            },
            error: function(e) {
                alert('出错啦');
            }
        })

        $(document.body).on('click', '.class-detail', function() {
            location.href = './class-detail.html?banJiID=' + classId;
        })

        $(document.body).on('click', '.exam-detail', function() {
            location.href = './exam-detail.html?banJiID=' + classId;
        })
    </script>
</body>

</html>
